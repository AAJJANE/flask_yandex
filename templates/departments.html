{% extends "base.html" %}

{% block content %}
    <h3 class="text-center">{{ title }}</h3>
    {% if current_user.is_authenticated %}
        <a href="/add_departments" class="btn btn-secondary">Add a department</a>
        <a href="/" class="btn btn-secondary">Jobs</a>
    {% endif %}
    <table class="table">
        {% for dep in departments %}
            <div>
                <thead>
                    <tr>
                        <td colspan="5">
                            <h4>Department # {{ dep.id }}</h4>
                            {% if current_user.is_authenticated and current_user == dep.chief_obj %}
                                <div>
                                    <a href="/departments/{{ dep.id }}" class="btn btn-warning">
                                        Edit
                                    </a>
                                    <a onclick="showDeleteModal({{ dep.id }}, '{{ dep.title }}')" class="btn btn-danger">
                                        Remove
                                    </a>
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                    <tr class="table-secondary">
                        <th class="text-center">Title of department</th>
                        <th class="text-center">Chief</th>
                        <th class="text-center">Members</th>
                        <th class="text-center">Department Email</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">{{ dep.title }}</td>
                        <td class="text-center">{{ dep.chief_obj.fullname }}</td>
                        <td class="text-center">{{ dep.members }}</td>
                        <td class="text-center">{{ dep.email }}</td>
                    </tr>
                </tbody>

            </div>
        {% endfor %}
    </table>

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="deleteModalLabel">Removing a department</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <p>You really want to remove <strong>Department # <span id="deleteModalId">%id%</span></strong></p>
              <p>"<i id="deleteModalTitle"></i>" ?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <a id="deleteModalBtn" href="" class="btn btn-danger">REMOVE</a>
          </div>
        </div>
      </div>
    </div>

    <script>
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        function showDeleteModal(id, title) {
            document.getElementById('deleteModalId').innerText = '' + id;
            document.getElementById('deleteModalTitle').innerText = title;
            document.getElementById('deleteModalBtn').setAttribute('href', `/departments_delete/${id}`);
            deleteModal.show();
        }
    </script>
{% endblock %}
